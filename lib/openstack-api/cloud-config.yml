#cloud-config
apt_upgrade: true
packages:
 - docker.io
 - nano
write_files:
 - encoding: b64
   content: |
     dmVyc2lvbjogJzMnCgpzZXJ2aWNlczoKICBiZWRyb2NrLWxlZGdlci10ZXN0OgogICAgIyBidWls
     ZDoKICAgICAgIyBjb250ZXh0OiAuCiAgICAgICMgZG9ja2VyZmlsZTogRG9ja2VyZmlsZQogICAg
     aW1hZ2U6IGRpZ2l0YWxiYXphYXIvYmVkcm9jay1sZWRnZXItdGVzdDpsYXRlc3QKICAgIGNvbnRh
     aW5lcl9uYW1lOiBiZWRyb2NrLWxlZGdlci10ZXN0CiAgICByZXN0YXJ0OiB1bmxlc3Mtc3RvcHBl
     ZAogICAgZW52X2ZpbGU6IGRvY2tlci1jb21wb3NlLmVudgogICAgIyBlbnZpcm9ubWVudDoKICAg
     IHBvcnRzOgogICAgICAtICIxODQ0MzoxODQ0MyIKICAgICMgdm9sdW1lczoKICAgIG5ldHdvcmtz
     OgogICAgICAtIGFwcC1uZXR3b3JrCiAgbW9uZ28tZG9ja2VyOgogICAgaW1hZ2U6IG1vbmdvOmxh
     dGVzdAogICAgY29udGFpbmVyX25hbWU6IG1vbmdvLWRvY2tlcgogICAgcmVzdGFydDogdW5sZXNz
     LXN0b3BwZWQKICAgICMgZW52X2ZpbGU6IC5lbnYKICAgICMgZW52aXJvbm1lbnQ6CiAgICAgICMg
     LSBNT05HT19JTklUREJfUk9PVF9VU0VSTkFNRT0kTU9OR09fVVNFUk5BTUUKICAgICAgIyAtIE1P
     TkdPX0lOSVREQl9ST09UX1BBU1NXT1JEPSRNT05HT19QQVNTV09SRAogICAgIyB2b2x1bWVzOgog
     ICAgICAjIC0gZGJkYXRhOi9kYXRhL2RiCiAgICBuZXR3b3JrczoKICAgICAgLSBhcHAtbmV0d29y
     awogIHJlZGlzLWRvY2tlcjoKICAgIGltYWdlOiByZWRpczpsYXRlc3QKICAgIGNvbnRhaW5lcl9u
     YW1lOiByZWRpcy1kb2NrZXIKICAgIHJlc3RhcnQ6IHVubGVzcy1zdG9wcGVkCiAgICBuZXR3b3Jr
     czoKICAgICAgLSBhcHAtbmV0d29yawpuZXR3b3JrczoKICBhcHAtbmV0d29yazoKICAgIGRyaXZl
     cjogYnJpZGdlCg==
   owner: root:root
   path: "/run/docker-compose.yml"
 - encoding: b64
   content: _ENVFILE_
   owner: root:root
   path: "/run/docker-compose.env"
runcmd:
 - timedatectl set-timezone America/New_York
 - systemctl enable docker
 - systemctl start docker
 - cd /run
 - curl -L "https://github.com/docker/compose/releases/download/1.24.0/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
 - chmod +x /usr/local/bin/docker-compose
 - ln -s /usr/local/bin/docker-compose /usr/bin/docker-compose
 - docker-compose up -d
