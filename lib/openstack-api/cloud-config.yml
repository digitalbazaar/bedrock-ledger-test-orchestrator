## template: jinja
#cloud-config
apt_upgrade: true
packages:
 - docker.io
 - nano
write_files:
 - encoding: b64
   content: |
     dmVyc2lvbjogJzMnCgpzZXJ2aWNlczoKICBiZWRyb2NrLWxlZGdlci10ZXN0OgogICAgIyBidWls
     ZDoKICAgICAgIyBjb250ZXh0OiAuCiAgICAgICMgZG9ja2VyZmlsZTogRG9ja2VyZmlsZQogICAg
     aW1hZ2U6IGRpZ2l0YWxiYXphYXIvYmVkcm9jay1sZWRnZXItdGVzdDpsYXRlc3QKICAgIGNvbnRh
     aW5lcl9uYW1lOiBiZWRyb2NrLWxlZGdlci10ZXN0CiAgICByZXN0YXJ0OiB1bmxlc3Mtc3RvcHBl
     ZAogICAgZGVwZW5kc19vbjoKICAgICAgLSBtb25nby1kb2NrZXIKICAgICAgLSByZWRpcy1kb2Nr
     ZXIKICAgIGVudl9maWxlOiBkb2NrZXItY29tcG9zZS5lbnYKICAgICMgZW52aXJvbm1lbnQ6CiAg
     ICBwb3J0czoKICAgICAgLSAiMTg0NDM6MTg0NDMiCiAgICAjIHZvbHVtZXM6CiAgICBuZXR3b3Jr
     czoKICAgICAgLSBhcHAtbmV0d29yawogIG1vbmdvLWRvY2tlcjoKICAgIGltYWdlOiBtb25nbzps
     YXRlc3QKICAgIGNvbnRhaW5lcl9uYW1lOiBtb25nby1kb2NrZXIKICAgIHJlc3RhcnQ6IHVubGVz
     cy1zdG9wcGVkCiAgICAjIGVudl9maWxlOiAuZW52CiAgICAjIGVudmlyb25tZW50OgogICAgICAj
     IC0gTU9OR09fSU5JVERCX1JPT1RfVVNFUk5BTUU9JE1PTkdPX1VTRVJOQU1FCiAgICAgICMgLSBN
     T05HT19JTklUREJfUk9PVF9QQVNTV09SRD0kTU9OR09fUEFTU1dPUkQKICAgICMgdm9sdW1lczoK
     ICAgICAgIyAtIGRiZGF0YTovZGF0YS9kYgogICAgbmV0d29ya3M6CiAgICAgIC0gYXBwLW5ldHdv
     cmsKICByZWRpcy1kb2NrZXI6CiAgICBpbWFnZTogcmVkaXM6bGF0ZXN0CiAgICBjb250YWluZXJf
     bmFtZTogcmVkaXMtZG9ja2VyCiAgICByZXN0YXJ0OiB1bmxlc3Mtc3RvcHBlZAogICAgbmV0d29y
     a3M6CiAgICAgIC0gYXBwLW5ldHdvcmsKbmV0d29ya3M6CiAgYXBwLW5ldHdvcms6CiAgICBkcml2
     ZXI6IGJyaWRnZQo=
   owner: root:root
   path: "/run/docker-compose.yml"
 - content: |
     {{ _ENVFILE_ }} 
   owner: root:root
   path: "/run/docker-compose.env"
runcmd:
 - timedatectl set-timezone America/New_York
 - systemctl enable docker
 - systemctl start docker
 - cd /run
 - curl -L "https://github.com/docker/compose/releases/download/1.24.0/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
 - chmod +x /usr/local/bin/docker-compose
 - ln -s /usr/local/bin/docker-compose /usr/bin/docker-compose
 - docker-compose up -d
