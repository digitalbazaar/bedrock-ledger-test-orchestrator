#cloud-config
apt_upgrade: true
packages:
 - docker.io
 - nano
write_files:
 - encoding: b64
   content: |
     dmVyc2lvbjogJzMnCgpzZXJ2aWNlczoKICBiZWRyb2NrLWxlZGdlci10ZXN0OgogICAgIyBidWls
     ZDoKICAgICAgIyBjb250ZXh0OiAuCiAgICAgICMgZG9ja2VyZmlsZTogRG9ja2VyZmlsZQogICAg
     aW1hZ2U6IG1hdHRjb2xsaWVyL2JlZHJvY2stbGVkZ2VyLXRlc3Q6bGF0ZXN0CiAgICBjb250YWlu
     ZXJfbmFtZTogYmVkcm9jay1sZWRnZXItdGVzdAogICAgcmVzdGFydDogdW5sZXNzLXN0b3BwZWQK
     ICAgIGVudl9maWxlOiBkb2NrZXItY29tcG9zZS5lbnYKICAgICMgZW52aXJvbm1lbnQ6CiAgICBw
     b3J0czoKICAgICAgLSAiMTg0NDM6MTg0NDMiCiAgICAjIHZvbHVtZXM6CiAgICBuZXR3b3JrczoK
     ICAgICAgLSBhcHAtbmV0d29yawogIG1vbmdvLWRvY2tlcjoKICAgIGltYWdlOiBtb25nbzpsYXRl
     c3QKICAgIGNvbnRhaW5lcl9uYW1lOiBtb25nby1kb2NrZXIKICAgIHJlc3RhcnQ6IHVubGVzcy1z
     dG9wcGVkCiAgICAjIGVudl9maWxlOiAuZW52CiAgICAjIGVudmlyb25tZW50OgogICAgICAjIC0g
     TU9OR09fSU5JVERCX1JPT1RfVVNFUk5BTUU9JE1PTkdPX1VTRVJOQU1FCiAgICAgICMgLSBNT05H
     T19JTklUREJfUk9PVF9QQVNTV09SRD0kTU9OR09fUEFTU1dPUkQKICAgICMgdm9sdW1lczoKICAg
     ICAgIyAtIGRiZGF0YTovZGF0YS9kYgogICAgbmV0d29ya3M6CiAgICAgIC0gYXBwLW5ldHdvcmsK
     ICByZWRpcy1kb2NrZXI6CiAgICBpbWFnZTogcmVkaXM6bGF0ZXN0CiAgICBjb250YWluZXJfbmFt
     ZTogcmVkaXMtZG9ja2VyCiAgICByZXN0YXJ0OiB1bmxlc3Mtc3RvcHBlZAogICAgbmV0d29ya3M6
     CiAgICAgIC0gYXBwLW5ldHdvcmsKbmV0d29ya3M6CiAgYXBwLW5ldHdvcms6CiAgICBkcml2ZXI6
     IGJyaWRnZQo=
   owner: root:root
   path: "/run/docker-compose.yml"
write_files:
 - encoding: b64
   content: _ENVFILE_
   owner: root:root
   path: "/run/docker-compose.env"
runcmd:
 - timedatectl set-timezone America/New_York
 - systemctl enable docker
 - systemctl start docker
 - cd /run
 - curl -L "https://github.com/docker/compose/releases/download/1.24.0/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
 - chmod +x /usr/local/bin/docker-compose
 - ln -s /usr/local/bin/docker-compose /usr/bin/docker-compose
 - docker-compose up -d
